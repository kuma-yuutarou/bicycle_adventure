


<div class="row justify-content-md-center">
  <h1>投稿詳細</h1>
</div>

<div class="container">

  <%#= 投稿ユーザー情報%><%#= 画像・名前・年齢・性別%>
  <%= link_to user_path(@post.id) do %>
    <%= image_tag @post.user.image, size: "200x200" %>
    <%= @post.user.name %>
  <% end %>
  <%= @post.user.age %>
  <%= @post.user.gender %>

  <%= @post.title %> <%#= タイトル名%>
  <% if @post.image.attached? %>
    <%= image_tag @post.image, size: "200x200" %> <%#= 写真表示%>
  <% end %>
  <%= @post.explanation %> <%#= 説明%>
  <% @post.tags.each do |tag| %><%#= 地名タグ%>
    <span><%= tag.name %></span>
  <% end %>

  <% if current_user == @user %> <%#= 投稿したユーザーにのみ表示%>
    <%= link_to "投稿削除", post_path(@post), method: :delete %>
  <% end %>

  <%#= いいね機能%>
  <% if @post.liked_by?(current_user) %>
    <p>
      <%= link_to post_likes_path(@post), method: :delete do %>
         ♥<%= @post.likes.count %> いいね
      <% end %>
    </p>
  <% else %>
    <p>
      <%= link_to post_likes_path(@post), method: :post do %>
        ♡<%= @post.likes.count %> いいね
      <% end %>
    </p>
  <% end %>

  <h5>住所</h5>
<p><%= @post.address %></p>

<!-- Googleマップ表示エリア(地図を表示) -->
<div id="map"></div>

  <%#= コメント機能 %>
  <p>コメント件数：<%= @post.comments.count %></p>
  <% @post.comments.each do |comment| %>
    <%= link_to user_path(@post.id) do %>
      <%= comment.user.name %>
    <% end %>
    <%= comment.body %>
    <%= comment.created_at.strftime('%Y/%m/%d') %>
    <% if comment.user == current_user %>
      <%= link_to "削除", post_comment_path(comment.id), method: :delete %>
    <% end %>
  <% end %>

  <%= form_with model: [@post, @comment] do |f| %>
    <%= f.text_area :body, rows: '10', placeholder: "コメントをここに" %>
    <%= f.submit "送信する" %>
  <% end %>
</div>


<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDuRsdadlZWuqaG1_7G9qwjLB5fimOn5Ag&callback=initMap" async defer></script>

<!-- Googleマップ表示用の Javascript -->
<script>
  function initMap(){
    // 地図の位置情報(緯度・経度)を取得
    let mapPosition = {lat: <%= @post.latitude || 0 %> , lng: <%= @post.longitude || 0 %> };
    let map = new google.maps.Map(document.getElementById('map'), {
      zoom: 15,
      center: mapPosition
    });
//    let transitLayer = new google.maps.TransitLayer();
//    transitLayer.setMap(map);

    let contentString = '【住所】<%= @post.address %>';
    let infowindow = new google.maps.InfoWindow({
      content: contentString
    });

    let marker = new google.maps.Marker({
      position: mapPosition,
      map: map,
      title: contentString
    });

    marker.addListener('click', function(){
      infowindow.open(map, marker);
    });
  }
</script>
